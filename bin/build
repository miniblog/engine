#!/usr/bin/env php
<?php

declare(strict_types=1);

use DanBettles\Marigold\CssMinifier;
use Miniblog\Engine\Console as Console;

require __DIR__ . '/../vendor/danbettles/marigold/src/CssMinifier.php';
require __DIR__ . '/console.inc.php';

$projectDir = dirname(__DIR__);

// ###> Config ###
$stylesheetPathnames = [
    "{$projectDir}/vendor/csstools/sanitize.css/sanitize.css",
    "{$projectDir}/vendor/csstools/sanitize.css/assets.css",
    "{$projectDir}/assets/app.css",
];

$mainStylesheetPathname = "{$projectDir}/templates/stylesheet.css";
// ###< Config ###

Console\writeLn("Creating `{$mainStylesheetPathname}`.");

$mergedCss = implode("\n", array_map(function (string $pathname): string {
    if (!is_file($pathname)) {
        Console\failed("The file `{$pathname}` does not exist.");
    }

    return file_get_contents($pathname);
}, $stylesheetPathnames));

$minifiedCss = (new CssMinifier())->minify($mergedCss);

if (!(bool) file_put_contents($mainStylesheetPathname, $minifiedCss)) {
    Console\failed("Failed to create `{$mainStylesheetPathname}`.");
}

Console\passthru("git add {$mainStylesheetPathname}", false);

Console\succeeded();
